"use strict";(()=>{var M=(c=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(c,{get:(l,u)=>(typeof require<"u"?require:l)[u]}):c)(function(c){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+c+'" is not supported')});typeof window<"u"&&(window.require=function(c){switch(c){case"path":return{resolve:function(){return""}};case"os":return{};case"crypto":return{};default:throw new Error(`Dynamic require of "${c}" is not supported`)}});console.log("Shims.js is running");typeof global>"u"&&(window.global=window);typeof global.process>"u"&&(global.process={});typeof global.process.env>"u"&&(global.process.env={});global.process.cwd=global.process.cwd||(()=>"/");typeof global>"u"&&(window.global=window);global.process=global.process||{};global.process.env=global.process.env||{};global.Buffer=global.Buffer||{};var F,U,R;typeof process<"u"&&process.versions&&process.versions.node&&(F=M("path"),U=M("os"),R=M("crypto"));document.querySelector("[activity-data='image']").removeAttribute("srcset");document.querySelector("[activity-data='liked']").removeAttribute("srcset");var C=!1,O={};console.log("Initial favoritesState:",JSON.stringify(O));var B={};console.log("Initial isManuallyChanged:",JSON.stringify(B));async function D(c,l,u){console.log("destination id",l),console.log("activityId",c),console.log("datastoreeeee",u),console.log("guide.id",u._guide_of_trips[0].id);let t=u._guide_of_trips.find(y=>String(y.id)===l);console.log("Target dest",t);let x=[];t&&t._guide_recommendations&&(x=t._guide_recommendations.filter(y=>y._place.place_id!==c)),console.log("Related Activities",x);let q=document.querySelector("[activity-data='related-activity']");q.innerHTML="",x.forEach(y=>{let _=document.createElement("div");_.className="mini-card_component is-related-activity",_.setAttribute("related-activity-id",y.place_id);let p=y._place,v=document.createElement("div");v.className="margin-bottom margin-xsmall";let k=document.createElement("img");k.src=p.oa_place_image.url,k.className="mini-card_image",v.appendChild(k),_.appendChild(v);let S=document.createElement("div");S.className="mini-card_content";let A=document.createElement("div");A.className="margin-bottom margin-xxsmall";let g=document.createElement("div");g.className="text-weight-bold",g.innerText=p.google_name,A.appendChild(g),S.appendChild(A);let d=document.createElement("div");d.className="margin-bottom margin-xxsmall";let s=document.createElement("div");s.className="mini-card_tag-wrapper",s.innerHTML=`<img src="${p._place_category.category_icon.url}" class="mini-card_tag-icon">
                              <div class="text-size-small text-color-grey">${p._place_category.category_name}</div>`,d.appendChild(s),S.appendChild(d);let h=document.createElement("div");h.className="rating-stars_component";let e=Math.floor(y._place.google_rating);for(let o=1;o<=5;o++){let i=document.createElement("img");i.className="activity-star",i.setAttribute("activity-data",`star-${o}`),o<=e?i.src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cbcc2d93ee2563a85e_star-blue.svg":i.src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cba4222a070cca9211_star-grey.svg",h.appendChild(i)}S.appendChild(h),_.appendChild(S),_.addEventListener("click",function(){let o=this.getAttribute("related-activity-id"),i=findActivityByIdInDataStore(u,o);i?flyToAndSetActive(i.coords):console.warn(`Activity with ID ${o} not found.`)}),q.appendChild(_)})}var $=[];function L(){let l=new URLSearchParams(window.location.search).get("activity_id");if(Object.values($).forEach(u=>{u.style.border="2px solid grey",u.style.zIndex="0";let t=u.getAttribute("original-image-url")||"default_image_url_here";u.style.backgroundImage=`url("${t}")`}),l&&$[l]){$[l].style.border="2px solid #636BFF",$[l].style.zIndex="1";let u=$[l].getAttribute("active-image-url")||"active_image_url_here";$[l].style.backgroundImage=`url("${u}")`}}async function T(c,l){let t=l._guide_of_trips.find(g=>g._guide_recommendations.some(d=>d.place_id.toString()===c.toString()))?._guide_recommendations.find(g=>g.place_id.toString()===c.toString());if(!t){console.log("Activity data is missing");return}document.querySelector("[activity-data='activity_description']").textContent=t._place._place_category.category_name||"No description available.";let x=t._place._favorite_of_user_of_place.find(g=>g.place_id===t.place_id);document.querySelector("[wized='activity_like_button']").setAttribute("activity-data-place-id",t.place_id),x?document.querySelector("[wized='activity_like_button']").setAttribute("activity-data-id",x.id):document.querySelector("[wized='activity_like_button']").removeAttribute("activity-data-id"),document.querySelector("[activity-data='image']").src=t._place.oa_place_image.url,document.querySelector("[activity-data='title']").innerText=t._place.google_name,document.querySelector("[activity-data='category_icon']").src=t._place._place_category.category_icon_black.url,document.querySelector("[activity-data='address']").innerText=t._place.google_address_string,document.querySelector("[activity-data='phone_number']").innerText=t._place.google_phone_number,document.querySelector("[activity-data='instagram_name']").innerText=t._place.instagram_url,document.querySelector("[activity-data='place_url']").href=t._place.google_place_url,document.querySelector("[activity-data='place_url']").innerText=t._place.place_url,document.querySelector("[activity-data='sub_title']").innerText=t.note,document.querySelector("[activity-data='activity_category']").innerText=t._place.oa_category;function q(g){return g.split("_")[0].split("  ")[0]}let y=t._place._destination_activity.mobi_destination_name,_=q(y);document.querySelector("[activity-data='related-title']").innerText="Other "+_+" activities",document.querySelector("[activity-data='activity_details_title']").innerText=t._place.oa_category+" Details",document.querySelector("[activity-data='activity_description']").innerText=t._place.google_place_description,document.querySelector("[activity-data='instagram_url']").href=t._place.instagram_url,document.querySelector("[activity-data='place_url_link']").href=t._place.place_url,document.querySelector("[activity-data='directions']").href=t._place.google_place_url,document.querySelector("[activity-data='phone_number_link']").href=`tel:${t._place.google_phone_number}`,document.querySelector("[activity-data='google_rating']").textContent=t._place.google_rating,document.querySelector("[activity-data='oh_monday']").textContent=t._place.google_monday_hours?t._place.google_monday_hours:"Not added",document.querySelector("[activity-data='oh_tuesday']").textContent=t._place.google_tuesday_hours?t._place.google_tuesday_hours:"Not added",document.querySelector("[activity-data='oh_wednesday']").textContent=t._place.google_wednesday_hours?t._place.google_wednesday_hours:"Not added",document.querySelector("[activity-data='oh_thursday']").textContent=t._place.google_thursday_hours?t._place.google_thursday_hours:"Not added",document.querySelector("[activity-data='oh_friday']").textContent=t._place.google_friday_hours?t._place.google_friday_hours:"Not added",document.querySelector("[activity-data='oh_saturday']").textContent=t._place.google_saturday_hours?t._place.google_saturday_hours:"Not added",document.querySelector("[activity-data='oh_sunday']").textContent=t._place.google_sunday_hours?t._place.google_sunday_hours:"Not added";let p=JSON.parse(localStorage.getItem("favoritesState"))||{},v=JSON.parse(localStorage.getItem("isManuallyChanged"))||{};console.log("Initial favoritesState:",JSON.stringify(p)),console.log("Initial isManuallyChanged:",JSON.stringify(v));function k(){document.querySelectorAll('[wized="activity_like_button"]').forEach(d=>{let s=d.cloneNode(!0);d.parentNode.replaceChild(s,d)}),document.querySelectorAll('[wized="activity_like_button"]').forEach(d=>{let s=d.getAttribute("activity-data-place-id");console.log(`Processing element with parentPlaceId: ${s}`),v[s]?console.log(`State manually changed for parentPlaceId: ${s}`):(console.log(`State not manually changed for parentPlaceId: ${s}`),p[s]=d.getAttribute("activity-liked")==="true"),S(d,p[s]),d.addEventListener("click",function(){console.log(`activity_like_button clicked for parentPlaceId: ${s}`),console.log(`Current favorite state before toggle: ${p[s]}`);let h=!p[s];console.log(`New favorite state after toggle: ${h}`),p[s]=h,v[s]=!0,localStorage.setItem("favoritesState",JSON.stringify(p)),localStorage.setItem("isManuallyChanged",JSON.stringify(v)),S(d,h),console.log(`Updated favoritesState and isManuallyChanged for parentPlaceId ${s}`)})})}function S(g,d){let s=g.querySelector(".floating-round-button_icon");d?s.src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/646356c55116c668dfccf4ae_heart-filled.svg":s.src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643568f2cf264582be96a5ce_heart.svg",console.log(`Updating UI icon for favorite: ${d}`)}k();let A=Math.floor(t._place.google_rating);for(let g=1;g<=5;g++){let d=document.querySelector(`[activity-data='star-${g}']`);g<=A?(console.log(A),d.setAttribute("src","https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cbcc2d93ee2563a85e_star-blue.svg")):d.setAttribute("src","https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cba4222a070cca9211_star-grey.svg")}document.querySelector("[wized=activity_info_modal]").style.display="block"}window.onload=async()=>{mapboxgl.accessToken="pk.eyJ1Ijoiam9yZGFub25hcnJpdmFsIiwiYSI6ImNsbHY4bW0zaTFxZ3czZ256bjlqODZmNncifQ.1xHX4Xvmvz9KNYmrZdFybA",document.querySelector("[wized=activity_info_modal]").style.display="none",console.log("Window loaded"),Wized.request.awaitAllPageLoad(async()=>{Wized.request.await("Load Trip Page");let c=await Wized.data.get("r.18.d"),l=new URLSearchParams(window.location.search),u=l.get("destination_id"),t=l.get("activity_id"),x=document.querySelector('[wized="destination_nav"]');console.log("dataStore:",c),c._guide_of_trips.forEach(e=>{let o=document.createElement("a");o.setAttribute("wized","destination_nav_id"),o.setAttribute("href","#"),o.setAttribute("data-destination-id",e.id),o.classList.add("mab_tabs-wrapper","w-inline-block");let i=document.createElement("p");i.setAttribute("wized","destination_nav_name"),i.setAttribute("data-destination-id",e.id),i.textContent=e.place,i.classList.add("map_tabs-link"),o.appendChild(i),x.appendChild(o),D(t,u,c),o.addEventListener("click",function(){console.log(`Clicked on destination ID: ${e.id}, Place: ${e.place}`),l.delete("activity_id"),history.replaceState({},"",`${location.pathname}?${l}`),console.log("Replaced State");let a=g.filter(r=>r.destinationId===e.id);h(a,_)})}),u&&(document.querySelectorAll("[data-destination-id]").forEach(e=>{e.classList.remove("is-active"),e.getAttribute("data-destination-id")===u&&(console.log("tried adding class"),e.classList.add("is-active"))}),document.querySelectorAll("[data-destination-id]").forEach(e=>{e.addEventListener("click",function(o){document.querySelectorAll("[data-destination-id]").forEach(a=>a.classList.remove("is-active")),o.currentTarget.classList.add("is-active");let i=document.querySelector("[wized='activity_info_modal']");i&&(i.style.display="none")})}));let q=document.querySelectorAll('[wized="destination_nav"]');q.forEach(e=>{console.log(q),e.getAttribute("data-destination-id")===u?e.classList.add("is-active"):e.classList.remove("is-active")}),t&&T(t,c);let y=[0,0];if(u){for(let e of c._guide_of_trips)if(e.id.toString()===u){let o=e._destination&&e._destination[0];y=[o.mobi_lng,o.mobi_lat];break}}else{let e=c._guide_of_trips[0],o=e._destination&&e._destination[0];y=[o.mobi_lng,o.mobi_lat]}let _=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:y,zoom:17}),p=null;function v(e){console.log("Fly to place",e);let i=10*16;_.flyTo({center:[e.google_lng,e.google_lat],zoom:15,offset:[i,0]});let a=document.querySelector(`[marker_activity_id="${e.id}"]`),r=e._place_category.category_icon_active.url;a&&(a.style.border="2px solid #636BFF",a.style.backgroundImage=`url("${r}")`,p=a)}document.querySelectorAll("[data-destination-id]").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll("[data-destination-id]").forEach(a=>{a.classList.remove("is-active")}),this.classList.add("is-active");let o=this.getAttribute("data-destination-id");console.log(`Destination ID clicked: ${o}`);let i=c._guide_of_trips.find(a=>a.id.toString()===o);if(console.log(c._guide_of_trips),console.log(o),i&&i._destination&&i._destination[0]){let r=i._guide_recommendations.map(n=>[n._place.google_lng,n._place.google_lat]);h(r,_);let w=new URLSearchParams(window.location.search);w.set("destination_id",o),w.delete("activity_id"),history.replaceState({},"",`${location.pathname}?${w}`),console.log("Replaced State")}})});function k(e,o){let[i,a]=e,[r,w]=o;return Math.sqrt(Math.pow(r-i,2)+Math.pow(w-a,2))}_.on("moveend",()=>{let e=_.getCenter().toArray();console.log("Map moved, center is: ",e);let o=null,i=1/0;if(c._guide_of_trips.forEach(a=>{let r=a;if(r.id){let w=[r._destination[0].mobi_lng,r._destination[0].mobi_lat];console.log(w);let n=k(e,w);console.log("Calculated distance: ",n),n<i&&(i=n,o={id:r.id,mobi_lat:r._destination[0].mobi_lat,mobi_lng:r._destination[0].mobi_lng},console.log("Updated closest destination: ",o))}}),o){console.log("Closest destination is: ",o),document.querySelectorAll("[data-destination-id]").forEach(r=>{console.log("Removing is-active class from: ",r),r.classList.remove("is-active")});let a=document.querySelector(`[data-destination-id="${o.id}"]`);a?(console.log("Adding is-active class to: ",a),a.classList.add("is-active")):console.log(`No element found for destination_id: ${o}`)}else console.log("No closest destination found")});function S(){return window.innerWidth<=1024}_.addControl(new mapboxgl.NavigationControl);function A(e,o,i){let a=e._place;if(console.log("Marker added at:",a.google_lng,a.google_lat),!a)return null;let r=a._place_category.category_icon.url,w=a._place_category.category_icon_active.url,n=document.createElement("div");n.style.backgroundImage=`url("${r}")`,n.setAttribute("original-image-url",r),n.setAttribute("active-image-url",w),n.setAttribute("marker_activity_id",e.place_id),n.style.backgroundRepeat="no-repeat",n.style.backgroundPosition="center",n.style.backgroundSize="18px 18px",n.style.width="41px",n.style.height="25px",n.style.borderRadius="12.5px",n.style.backgroundColor="var(--primary-white, #FFF)",n.style.boxShadow="0px 4px 4px 0px rgba(35, 16, 94, 0.10)",n.style.border="2px solid grey";let f=new mapboxgl.Marker(n).setLngLat([a.google_lng,a.google_lat]).addTo(o),z=`
        <div class="mini-card_component is-popup" style="z-index: 100 !important;">
        <img src="${a.oa_place_image.url}" alt="" class="mini-card_image">
        <div class="mini-card_content">
        <div class="margin-bottom margin-xxsmall">
        <div class="text-weight-bold">${a.google_name}</div>
        </div>
        <div class="margin-bottom margin-xsmall">
        <div class="mini-card_tag-wrapper">
        <img src="${a._place_category.category_icon.url}" loading="lazy" alt="" class="mini-card_tag-icon">
        <div class="text-size-small text-color-grey">${a._place_category.category_name||"No description available."}</div>
        </div>
        </div>
        <div class="rating-stars_component">
        <img id="popup-star-1" src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cba4222a070cca9211_star-grey.svg" loading="lazy" alt="">
        <img id="popup-star-2" src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cba4222a070cca9211_star-grey.svg" loading="lazy" alt="">
        <img id="popup-star-3" src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cba4222a070cca9211_star-grey.svg" loading="lazy" alt="">
        <img id="popup-star-4" src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cba4222a070cca9211_star-grey.svg" loading="lazy" alt="">
        <img id="popup-star-5" src="https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cba4222a070cca9211_star-grey.svg" loading="lazy" alt="">
        </div>
        </div>
        <img loading="lazy" alt="" class="popup-card_arrow">
        </div>
        `,N=new mapboxgl.Popup({offset:25,closeButton:!1}).setHTML(z);N.on("open",()=>{let b=Math.floor(a.google_rating);for(let m=1;m<=5;m++){let E=N._content.querySelector(`#popup-star-${m}`);E&&(E.src=m<=b?"https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cbcc2d93ee2563a85e_star-blue.svg":"https://uploads-ssl.webflow.com/642d2be9a355e8eae598cfe4/643532cba4222a070cca9211_star-grey.svg")}}),o.on("click",()=>{document.querySelector("[wized=activity_info_modal]").style.display="none",i=null,s=null,l.delete("activity_id");let b=new URL(window.location.href);b.search=l.toString(),history.replaceState(null,null,b.toString()),console.log("Replaced State"),L()});function P(b){b.stopPropagation(),i=e.id,s=e.place_id,l.set("activity_id",e.place_id),history.replaceState({},"",`${location.pathname}?${l}`),console.log("Replaced State"),console.log(`Marker clicked with activity ID: ${e.place_id}`),C=!1,T(e.place_id,c),L(),v(a),D(t,u,c)}if(S())n.addEventListener("touchend",P);else{n.addEventListener("mouseenter",()=>{let m=l.get("activity_id");if(n.style.cursor="pointer",n.getAttribute("marker_activity_id")===m)n.style.zIndex="0";else{let I=document.querySelector(`[marker_activity_id="${m}"]`);I&&(I.style.zIndex="0"),n.style.zIndex="0"}N.setLngLat(f.getLngLat()).addTo(o)});let b=l.get("activity_id");n.addEventListener("mouseleave",()=>{let m=l.get("activity_id");n.style.cursor="default";let E=document.querySelector(`[marker_activity_id="${m}"]`);E&&(E.style.zIndex="1");let I=n.getAttribute("marker_activity_id");I===m?n.style.zIndex="1":(console.log("0",I,m),n.style.zIndex="0"),N.remove()}),n.addEventListener("click",m=>{m.stopPropagation(),i=e.id,s=e.place_id,l.set("activity_id",e.place_id),history.replaceState({},"",`${location.pathname}?${l}`),console.log("Replaced State"),console.log(`Marker clicked with activity ID: ${e.place_id}`),L(),C=!1,T(e.place_id,c),v(a),D(b,u,c)})}return document.querySelectorAll("[wized='activity_close_button']").forEach((b,m)=>{b.getAttribute("data-listener")!=="true"&&(b.addEventListener("click",function(E){if(console.log(`Clicked button index: ${m}`),console.log("Current closeFlag state:",C),C)console.log("Skipped due to closeFlag being true");else{console.log("Inside closeFlag check"),document.querySelector("[wized=activity_info_modal]").style.display="none",console.log("Modal closed"),l.delete("activity_id"),console.log("Deleted activity_id");let I=new URL(window.location.href);I.search=l.toString(),history.replaceState(null,null,I.toString()),console.log("Replaced State"),C=!0,console.log("Updated closeFlag state:",C),L()}}),b.setAttribute("data-listener","true"))}),n}let g=[],d=[];var s=null;_.on("load",function(){console.log("Map loaded");let e=new URLSearchParams(window.location.search),o=e.get("destination_id"),i=e.get("activity_id"),a=!1;c._guide_of_trips.forEach(r=>{console.log(`Processing guide ID: ${r.id}`),(r._guide_recommendations||[]).forEach(n=>{let f=n._place;if(!f)return;console.log(`Adding coordinates: [${f.google_lng}, ${f.google_lat}]`),g.push([f.google_lng,f.google_lat]),r.id.toString()===o&&d.push([f.google_lng,f.google_lat]);let z=A(n,_,p);z&&(p=z,$[f.id]=z),console.log("This is place",f),String(f.id)===i&&(a=!0,v(f))})}),L(),window.addEventListener("popstate",L),console.log(`Generated ${g.length} coordinates`),console.log("Coordinates:",g),i&&!a&&console.log(`No activity found for ID: ${i}`),o&&!a?(console.log(`Setting map bounds for destination_id: ${o}`),h(d,_)):a||console.log("No destination_id or activity_id found. Using default map settings.")});function h(e,o){if(!e.length)return;let i=e.reduce((a,r)=>a.extend(r),new mapboxgl.LngLatBounds(e[0],e[0]));o.fitBounds(i,{padding:60})}})};})();
